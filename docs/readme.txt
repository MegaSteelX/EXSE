EXSE 中文文档

关于EXSE
EXSE工程的主旨是利用模块化的图像组件解决所有游戏卡片及卡片类似物的较高质量批量化制图问题。
平台
目前主工程基于Android系统开发，面向基于Google Android（版本号4.0.0）以上操作系统及为上述系统提供兼容的操作系统。
文件夹
为方便叙述，文中未说明时均以"系统内置存储/exse"为根目录，所有叙述均为默认情况下。
/savedata：存储保存的存档文件。
/res：存储卡片样式资源。
/pic：存储导出的图片文件。
/temp：存储工作中产生的临时文件，包括断点存档。

卡片样式
定义
为产生基本的卡片图像模板并定义各图像组件的位置、大小、形状等以便于产生批量化卡片图像而预先制作并存储的信息（及其所存储的文件夹）。
存储格式
以该卡片样式的名称命名的文件夹；
或以上述文件夹所有内容进行标准zip压缩并以该卡片样式命名，以".xtl"为后缀名的压缩文件。
内容
卡片样式应该至少包含以下3个纯文本文件：
items.dfn：指定卡片应该包含的图片组件（称为项目/item）
语法为
<item_type>/<item_name>[换行符]{下一行数据}
common.mdl：指定通常情况下各项目/item的位置、大小及其他属性
语法为
<item_name>/<width>/<height>/<left>/<top>/<ext-attribute>[换行符]{下一行数据}
new_card.dfn：指定当新建卡片数据时每个项目/item的赋值
语法为
card:[换行符]
[制表符]<item_name>:<item_data>[换行符][制表符]{下一行数据}
其中<item_type>为预装的项目种类(通常以首字母大写的两个英文单词组成)，<item_name>为样式制作者定义的项目名称，<item_data>为样式制作者指定的默认数据。

预留的项目item名称
cardface
此名称指定该项目为卡面，并定义卡图区域为以该项目的<width>为宽，<height>为高，保持宽高比放大到占据最大屏幕区域的矩形。通常其<top>和<left>应当为0。其他项目的四项定位数据将保持同样的比例。
image
此名称指定该项目为卡图（目前限定为PictureLoader），并在卡片列表的图片框展示。
name
此名称指定该项目为卡片名称，通常应当为一个文字类的项目，并在卡片列表的上部文本框展示。
text
此名称指定该项目为卡片的主要文字，通常应当为文字类的项目，并在卡片列表的下部文本框展示预览。

标记/marks
通过定义标记扩充卡片模板：标记系统提供一种可能性，使得当卡片的某项数据设定为给定的某个值时将卡片完全重设为另一个样式，或重设其中的部分项目。
标记相关的文件夹为/marks。本条目中下述文件目录均以/marks为根目录。
marks.dfn
定义文件。语法为
<mark>:<item_name>=<certain_value>[换行符]{下一行}
其中<certain_value>为欲标记<mark>时以<item_name>所对应的项目应该处于的值。即：当<item_name>取值变更为<certain_value>时标记<mark>，当不再满足条件时取消标记<mark>。
当<certain_name>以"<"或">"开头时，将后面的内容视为整数，判断该项目取值是否大于或小于该数值。
<mark>.mdl
当前如果标记为<mark>，则先读取common.mdl，再读取<mark>.mdl。语法与common.mdl相同；若同时生效多个标记，则在mark.dfn文件中定义靠前的先读取。
读取顺序影响最终的结果：后读取的相同项目的相同属性总是覆盖先读取的，不同属性则合并。
例如：先读取行text/800/600/0/0/color:#66CCFF;textsize:60，后读取行text/700/700/20/30/color:#FFFFFF;grivaty:L，则最后的结果相当于text/700/700/20/30/color:#FFFFFF;textsize:60;grivaty:L。
实际上，在不同的行中定义不同时存在的属性是危险的：在取消标记时通常将导致混乱。所以当在某行定义某个属性时，通常应当在相应的同名行定义相同的属性，即使你只想使用默认值。

注释与断行
在大部分的文本格式文件中，你可以使用以//开头的行编写注释，如：
//<注释文字>
该行会被程序跳过而不读取。
有时你可能会定义太多或太长的额外属性值，导致一行太长而难以读取。此时你可以使用…（英文省略号）来断开过长的行，如：
<line1>…
<line2>…
<line3>
与
<line1><line2><line3>
是等同的。但，被断开的行前面不能使用空格或/和制表符调整缩进。
注意1：与一般的程序语言不同，//不能用在行的中间以将后半行变成注释语句，只能位于行首将整行标记为注释行。也没有用/*和*/标记多行注释的用法。
注意2：在new_card.dfn定义文件中不生效。你无法在此文件中使用注释和断行;强行使用将导致运行出错。

项目/item详述+<ext-attribute>详解
<ext-attribute>
在.mdl文件的语法中，除以/分隔的五维公共属性以外的，以;隔离的<key>:<value>形式的属性描述。不同的项目有不同的属性。在下面的每个项目的说明中，以keys为标题列出可能的<key>及其指定的<value>格式。
ChosableImage
图片选择。当该项目被点击时，将检索当前卡片样式目录下与该项目同名的文件夹下的names.dfn文件（语法为<name>=<filename>[换行符]{下一行}）并弹出列有所有<name>的菜单：当菜单项被点击时，检索上述文件夹下的<filename>（应当为图片格式（jpg/bmp/png））并置为该项目的图像。
keys
showvoid：当取值为true时，在菜单开头添加一个选项"无"，点击后该项目图像置为全透明。取值范围为"true"和"false"。
childfolder：取值为“.”（不包括引号）或字符串，指定获取图片源的文件夹。默认为“.”，即从names.dfn同层获取图片源; 取值为字符串时，从以该字符串命名的子文件夹下获取图片源。
PictureLoader
相册加载。当点击该项目时，将从系统相册选择图片并剪裁，以剪裁后的图片置为该项目的图像。
keys
clickzone：格式为以"×"分隔的4个正整数组成的字符串或"self"。指定通常与该项目本身大小不同的一个区域响应该项目的点击事件，其中四个非负整数的顺序和读法与<width><height><left><top>四维完全类似。取值self为默认值，代表点击区域与图片区域完全重合。
ColorZone
颜色区域。提供一个可改变颜色并提供RGB值的纯色区域。点击时弹出调色板，亦可直接输入RGB色值定义颜色。
keys
clickzone：参见PictureLoader的相同子属性。
SinglineText
单行文本。提供一个可编辑的单行文本，当该文本长度超过项目本身的长度时，横向压缩。该文本使用的字体通常放在/fonts文件夹，并在该文件夹下的name.dfn纯文本文件的某行以<item_name>=<file_name>的格式定义，其中<file_name>为包括后缀名的字体文件名。
keys
vertical：取值为0/1/2，指定文字是否竖向显示（当取值大于0）。取值1时，应当在字体文件夹中存在名为@+<原字体名>，逆时针旋转90度的字体文件。实质是把整个控件顺时针旋转90度所以请注意定位四维的取值。取值2时，使用每行显示1个字符的方式变成伪纵向，不需要改变定位四维，但在缩小字号时有时会发生需要手动换行的状况。
textsize：指定文本的相对大小，类似于字号。取值应当为非负整数；当此key未被定义时默认取值10。
color：指定文本颜色。格式为#??????，其中?为从0到F的十六进制数字，??????构成一个RGB色标；未定义时，默认取值#000000（黑色）。
grivaty：指定文本位于文本范围的相对位置。取值为L（靠右）/C（居中）/R（靠左）；未定义时默认居中。
withicons：取值为true/false，表示该文本是否包含图片形式的字符，类似于QQ的小表情。其中icons（图片）有两种格式：icon1允许与高度不同的宽度，icon2则不允许。icons图片应该是裁切成正方形的png格式图片，以一个字符命名。若该字符为a-z，则视为icon2格式，否则视为icon1。
iconsize1：指定icon1格式的图片的相对大小。取值为非负整数，默认取10。
icon1width：指定icon1格式图片的相对宽度：宽度大于高度时用空档补足，否则裁切。取值为非负整数，默认取20。
iconsize2：指定icon2格式的图片的相对大小，同时也是其宽度。取值为非负整数，默认取10。
withstoke：指定文字是否使用另一种颜色描边，取值为true/false。注意：此属性仅在common.mdl中生效；若在mark对应的mdl文件中定义该属性且common.mdl未定义，则无法正常工作。
stokecolor：指定另一种颜色，使用该颜色描边。格式为#??????，其中?为从0到F的十六进制数字，??????构成一个RGB色标；未定义时，默认取值#FFFFFF（白色）。
stokewidth：指定描边的宽度。取值应当为正整数。
withshadow：取值为true/false，指定文字是否拥有阴影效果。注意：此属性仅在common.mdl中生效；若在mark对应的mdl文件中定义该属性且common.mdl未定义，则无法正常工作。
shadowx：取值为整数，阴影的相对水平偏移量，以向右为正。
shadowy：取值为整数，阴影的相对竖直偏移量，以向下为正。
shadowr：取值为整数，阴影的相对扩展量，取值应始终为正。
ParagraphText
段落文本。提供一段多行文本以供编辑。该文本使用的字体通常放在/fonts文件夹，并在该文件夹下的name.dfn纯文本文件的某行以<item_name>=<file_name>的格式定义，其中<file_name>为包括后缀名的字体文件名。
keys
vertical：指定文字是否竖向显示。注意此时应当在字体文件夹中存在名为@+<原字体名>，逆时针旋转90度的字体文件。实质是把整个控件顺时针旋转90度所以请注意定位四维的取值。
textsize：指定文本的相对大小，类似于字号。取值应当为非负整数；当此key未被定义时默认取值10。
color：指定文本颜色。格式为#??????，其中?为从0到F的十六进制数字，??????构成一个RGB色标；未定义时，默认取值#000000（黑色）。
grivaty：指定文本位于文本范围的相对位置。取值为两个字符，其中一个取L（靠右）/C（居中）/R（靠左），另一个取T（靠顶）/B（靠底）/C（居中）；未定义时默认两个方向均居中。
withicons：取值为true/false，表示该文本是否包含图片形式的字符，类似于QQ的小表情。其中icons（图片）的大小（宽、高）保持与当前字体大小一致。
linespace：指定当前行高为默认行高的倍数，取值为合理的小数。
outofzone：指定当前文字超出文本框大小时的处理方式：fixTextSize（减小字体适配文本框）,fixViewTop（从顶部扩充文本框）,fixViewBottom（从底部扩充文本框）,fixViewLeft（从左侧扩充文本框）,fixViewRight（从右侧扩充文本框）。
TouchSwitch
触发开关。制造一个无显示的可点击区域。点击该区域时，内置的一个布尔值（开始时为false）被置为其自身取值的非。通常用于触发标记事件。
ExchangeImage
可变图片。在点击时切换自身图片为/<folder>/name+<index>.png。其中<folder>默认为/exchangeimgs/，<index>默认从0开始，每次点击增加1，在无可用图片时归0。
keys
path：改变<folder>为该属性对应的值。（注意与ChosableImage的childfolder有所区别）
index：指定<index>开始显示时的值，默认为0。
ItemsGroup
项目编组。此项目包含一组若干个其他项目（为保持稳定，请尽量不要嵌套ItemsGroup）并可通过“+”、“-”按钮增加或减少同样的一组项目。
items.dfn中关于项目编组的特殊规则
在ItemsGroup对应行之后应额外附加诸如
/childNum:<number>,childType:<child1type>!<child1name>_<child2type>!<child2name>…
的半行内容，其中<number>应与其后用<type>!<name>定义并用_隔开的子item数目保持一致。
keys
gravity：指定多个组如何相对排列。取值为horizontal时，横向排列；取值为vertical、未定义此属性、取值为其他“错误”值时，纵向排列。
childs：在其后如同正常属性定义行地定义所有子item，使用%分隔。在子item定义中，按以下规则替换标点符号： /→!，:→_，;→-。
ItemsGroup内嵌mark
与标记/marks类似，在ItemGroup的组内通过某个项目的数据取值改变其他项目的样式。
marks/文件夹下的<name>.mrk为其定义文件，其中<name>为对应ItemsGroup的名称。格式为
<child1>=<data> -> <child2>{<extAttr2>},<child3>{<extAttr3>},… !> <child2>{<extAttr2'>},…
其中<childX>为子项目的名称，->后的数据组为当条件=成立时，!>后的数据组为=条件不成立时，其他各需要变动的子项目之变动情况;{}内的extAttr完全按前述<ext-attribute>规则编写。